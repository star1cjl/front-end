function getDaysInMonth(e,t){return new Date(e||(new Date).getFullYear(),t,0).getDate()}function getTargetDate(e,t,i){var a=i||new Date,l=a.getFullYear(),n=a.getMonth(),o=new Date,s=Math.floor(e/30);if(s<=0){var r=a.valueOf()-24*e*60*60*1e3;o=new Date(r)}else{for(var d=n-s;d<0;)d+=12,l--;o.setFullYear(l);var u=getDaysInMonth(l,d+1);u>a.getDate()&&(u=a.getDate()),o.setMonth(d,u),o.setHours(a.getHours()),o.setMinutes(a.getMinutes()),o.setSeconds(a.getSeconds()),o.setMilliseconds(a.getMilliseconds())}return t&&o<t?t:o}var util=function(){},hasTouch="ontouchstart"in window,EV="click",PAGE_SIZE=20;util.query=function(e,t){var i=e.url,a=e.dataWrapId||"dataWrapper",l=e.tplId,n=e.pullUpId||"pullUp",o=e.iScroll,s=e.indexRequired;delete e.id,delete e.dataWrapId,delete e.tplId,delete e.pullUpId,delete e.pullDownId,delete e.url,delete e.pullUpAction,delete e.pullDownAction,delete e.iScroll,delete e.indexRequired,$.ajax({url:i,type:"POST",data:e,dataType:"json",beforeSend:function(){1==e.pageIndex&&util.loadingToast()},success:function(i){if(util.removeToast(),!i||200!=i.code&&200!=i.rtnCode)util.dialog({info:i.msg||i.rtnMsg});else{var r="",d=$("#"+l).html();i.data&&i.data.forEach(function(t,i){s&&(t.index=(e.pageIndex-1)*e.pageSize+i+1),r+=d.format(t)}),1==e.pageIndex?$("#"+a).html(r):$("#"+a).append(r),$("#"+a).data("pageIndex",e.pageIndex),+i.totalPage&&1!=i.totalPage&&e.pageIndex!=i.totalPage?$("#"+n).removeClass("dn"):$("#"+n).addClass("dn"),o&&o.refresh(),t&&t(i.data)}},error:function(){util.dialog({info:"服务器异常，请稍候重试！"})}})},util.wxUploadImage=function(e,t,i,a){t=$.extend({count:1,sizeType:["original","compressed"],sourceType:["album","camera"]},t||{}),e.chooseImage({count:t.count,sizeType:t.sizeType,sourceType:t.sourceType,success:function(t){function l(){e.uploadImage({localId:n.localId[o],isShowProgressTips:1,success:function(e){o++,n.serverId.push(e.serverId),i&&i(localId,e.serverId),o<s&&l()},fail:function(e){alert(JSON.stringify(e)),a&&a(e)}})}var n={localId:[],serverId:[]};if(n.localId=t.localIds,0==n.localId.length)return void alert("请先使用 chooseImage 接口选择图片");var o=0,s=n.localId.length;l()}})},util.compose=function(e,t,i,a){function l(t){if(t<r){var i=new Image;i.src=data[t].url,i.onload=function(){s.drawImage(i,e[t].offsetX,e[t].offsetY,i.width,i.height),i=null,l(t+1)}}else n=o.toDataURL("image/jpeg",.8),o=null,a(n)}var n,o=document.createElement("canvas"),s=o.getContext("2d"),r=e.length;o.width=t,o.height=i,s.rect(0,0,o.width,o.height),s.fillStyle="#fff",s.fill(),l(0)},util.initIScroll=function(e){var t,i,a,l,n,e=e||{},o=e.pullDownAction||function(){t.refresh()},s=e.pullUpAction||function(){t.refresh()};document.addEventListener("touchmove",function(e){e.preventDefault()},!1),i=$("#"+(e.pullDownId||"pullDown")),i=i.length&&i[0],a=i&&i.offsetHeight,l=$("#"+(e.pullUpId||"pullUp"))[0],n=l.offsetHeight;var r=e.id||"wrapper",d=e.dataWrapId||"dataWrapper",u=$("#"+r),c=u.parents(".tab_wrap"),f=c.hasClass("dn");f&&c.removeClass("dn");var g=u.position().top;return u.css({position:"absolute",left:0,top:g+"px",bottom:0,width:"100%"}),f&&c.addClass("dn"),t=new iScroll(r,{vScrollbar:!1,topOffset:a||0,onRefresh:function(){i&&i.className.match("loading")?($(i).removeClass("loading"),i.querySelector(".pullDownLabel").innerHTML="下拉刷新..."):l.className.match("loading")&&($(l).removeClass("loading"),l.querySelector(".pullUpLabel").innerHTML="上拉加载更多...")},onScrollMove:function(){if(this.y>5&&i&&!i.className.match("flip"))$(i).addClass("flip"),i.querySelector(".pullDownLabel").innerHTML="松手开始更新...",this.minScrollY=0;else if(this.y<this.maxScrollY-5&&!l.className.match("flip")){if($(l).hasClass("dn"))return;$(l).addClass("flip"),l.querySelector(".pullUpLabel").innerHTML="松手开始更新..."}},onScrollEnd:function(){if(i&&i.className.match("flip"))$(i).removeClass("flip").addClass("loading"),i.querySelector(".pullDownLabel").innerHTML="加载中...",o(1);else if(l.className.match("flip")){$(l).removeClass("flip").addClass("loading"),l.querySelector(".pullUpLabel").innerHTML="加载中...";var e=$("#"+d).data("pageIndex")||1;s(++e)}}})},util.showActionSheet=function(e){var t=$("#mask"),i=$("#weui_actionsheet");i.addClass("weui_actionsheet_toggle"),t.show().focus().addClass("weui_fade_toggle").one("click",function(){util.hideActionSheet()}),$("#actionsheet_cancel").one("click",function(){e&&e(),util.hideActionSheet()}),t.unbind("transitionend").unbind("webkitTransitionEnd")},util.hideActionSheet=function(){var e=$("#mask"),t=$("#weui_actionsheet");t.removeClass("weui_actionsheet_toggle"),e.removeClass("weui_fade_toggle"),e.on("transitionend",function(){e.hide()}).on("webkitTransitionEnd",function(){e.hide()})},util.dialog=function(e){var t='<div class="weui_dialog_confirm" id="dialog"><div class="weui_mask"></div><div class="weui_dialog"><div class="weui_dialog_hd"><strong class="weui_dialog_title">'+(e.title||"提示")+'</strong></div><div class="weui_dialog_bd">'+e.info+'</div><div class="weui_dialog_ft">'+(e.cancel?'<a href="javascript:;" class="weui_btn_dialog default">取消</a>':"")+'<a href="javascript:;" class="weui_btn_dialog primary">确定</a></div></div></div>',i=$(t);i.on(EV,".weui_btn_dialog.default",function(){e.cancelCb&&e.cancelCb(),$("#dialog").remove()}).on(EV,".weui_btn_dialog.primary",function(){e.okCb&&e.okCb(),$("#dialog").remove()}),$("body").append(i)},util.toast=function(e){var t='<div id="toast"><div class="weui_mask_transparent"></div><div class="weui_toast"><i class="weui_icon_toast"></i><p class="weui_toast_content">'+e+"</p></div></div>";$("body").append(t),setTimeout(function(){$("#toast").remove()},2e3)},util.loadingToast=function(){var e='<div id="loadingToast" class="weui_loading_toast"><div class="weui_mask_transparent"></div><div class="weui_toast"><div class="weui_loading"><div class="weui_loading_leaf weui_loading_leaf_0"></div><div class="weui_loading_leaf weui_loading_leaf_1"></div><div class="weui_loading_leaf weui_loading_leaf_2"></div><div class="weui_loading_leaf weui_loading_leaf_3"></div><div class="weui_loading_leaf weui_loading_leaf_4"></div><div class="weui_loading_leaf weui_loading_leaf_5"></div><div class="weui_loading_leaf weui_loading_leaf_6"></div><div class="weui_loading_leaf weui_loading_leaf_7"></div><div class="weui_loading_leaf weui_loading_leaf_8"></div><div class="weui_loading_leaf weui_loading_leaf_9"></div><div class="weui_loading_leaf weui_loading_leaf_10"></div><div class="weui_loading_leaf weui_loading_leaf_11"></div></div><p class="weui_toast_content">数据加载中</p></div></div>';$("body").append(e)},util.removeToast=function(){$("#toast, #loadingToast").remove()},util.strLen=function(e){return(e||"").replace(/[^\x00-\xff]/g,"00").length},util.formatBankCard=function(e,t){return e=e.replace(/\s/g,""),t?e.substring(0,6)+"*****"+e.substring(e.length-4):e.replace(/(\d{4})(?!$)/g,"$1 ")},util.isValidId=function(e){return/(^\d{15}$)|(^\d{17}([0-9]|X|x)$)/.test(e)},util.isValidMobile=function(e){return/^1[34578]\d{9}$/.test(e)},util.queryToJson=function(e){for(var t,i,a,l,n=e.substr(e.lastIndexOf("?")+1),o=n.split("&"),s=o.length,r={},d=0;d<s;d++)o[d]&&(l=o[d].split("="),t=l[0],i=l[1],a=r[t],"undefined"==typeof a?r[t]=i:isArray(a)?a.push(i):r[t]=[a,i]);return r},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,a;if(null==this)throw new TypeError(" this is null or not defined");var l=Object(this),n=l.length>>>0;if("[object Function]"!={}.toString.call(e))throw new TypeError(e+" is not a function");for(t&&(i=t),a=0;a<n;){var o;a in l&&(o=l[a],e.call(i,o,a,l)),a++}}),Date.prototype.format=function(e){e=e||"yyyy-MM-dd";var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},String.prototype.format=function(e){var t,i=this;if(arguments.length>0)if(1==arguments.length&&"object"==typeof e)for(var a in e)t=new RegExp("({{"+a+"}})","g"),i=i.replace(t,e[a]||"");else for(var l=0;l<arguments.length;l++)t=new RegExp("({{)"+l+"(}})","g"),i=i.replace(t,arguments[l]||"");return i},Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1},Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},$(document).ready(function(){}),util.initPage=function(e){$(document).ready(function(){var e=$(window).height(),t=$("#weui_actionsheet").height();if($("#weui_actionsheet").height(e),e<=t?$("#weui_actionsheet").css({"overflow-y":"auto"}):$("#btnWrap").addClass("btnWrapAbs"),$("#filterRangeDate").length){var i=new pickerDateRange("filterRangeDate",{isTodayValid:!0,startDate:(new Date).format(),endDate:(new Date).format(),calendars:2,autoSubmit:!0,theme:"ta",defaultText:" 至 ",success:function(e){$("#filterRangeDate").text(""),$("#filterDate").text(e.startDate+" 至 "+e.endDate)}});$("#filterRangeDate").text(""),$("#filterDate").text((new Date).format()),window._dateRange=i}$("#consumptionTypeWrap").on(EV,"a.weui_grid",function(){$(".weui_grid_label",this).toggleClass("active");var e=$(".weui_grid_label",this).hasClass("active");if($(this).hasClass("check_all")){var t=e?"addClass":"removeClass";$(this).siblings().each(function(){$(".weui_grid_label",this)[t]("active")})}else if(e){var i=!0;$(this).siblings().each(function(){if(!$(this).hasClass("check_all"))return!$(".weui_grid_label",this).hasClass("active")&&(i=!1),i}),i&&$(".check_all .weui_grid_label").addClass("active")}else $(".check_all .weui_grid_label").removeClass("active")}),$("#settleTypeWrap, #storeWrap").on(EV,"a.weui_grid",function(){$(".weui_grid_label",this).toggleClass("active")}),$("#weui_actionsheet").on("click",".filter_back",function(){util.hideActionSheet()})})},util.initPrintMerName=function(e){$.ajax({url:e,type:"POST",dataType:"json",beforeSend:function(){util.loadingToast()},success:function(e){if(util.removeToast(),e&&200==e.code){var t="";e.data&&e.data.forEach(function(e){t+=" <a href='javascript:;' class='weui_grid'><p class='weui_grid_label'>"+e.terminalAlias+"</p></a>"}),$("#storeWrap").html(t)}},error:function(){}})},~function(){var e={},t=navigator.userAgent.toLowerCase();e.iPhone=/iphone os/.test(t),e.iPod=/ipod/i.test(t),e.iPad=/ipad/.test(t),e.android=/android/.test(t),util.browser=e}();