<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <title>门店管理</title>
    <link rel="stylesheet" type="text/css" href="css/weui.min.css">
    <link rel="stylesheet" type="text/css" href="css/wxbase.css">
    <script type="text/html" id="tpl_trmnl_info">
        <div class="weui_grids" data-terminalno="{{terminalNo}}" data-mrchntname="{{merchantShortName}}">
            <div class="weui_grid">
                <p class="weui_grid_label">{{terminalNo}}</p>
            </div>
            <div class="weui_grid">
                <p class="weui_grid_label">{{terminalStatus}}</p>
            </div>
            <div class="weui_grid">
                <p class="weui_grid_label">{{activeDate}}</p>
            </div>
            <div class="weui_grid">
                <p class="weui_grid_label">{{merchantShortName}}</p>
            </div>
        </div>
    </script>
    <script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="js/zepto.min.js"></script>
    <script type="text/javascript" src="js/iscroll.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
</head>

<body id="storeManageWrap">
    <!--     <div class="weui_cells weui_cells_form">
    <div class="weui_cell">
        <div class="weui_cell_hd">
            <label for="" class="weui_label">终端号</label>
        </div>
        <div class="weui_cell_bd weui_cell_primary">
            <input id="qTerminalNo" class="weui_input" type="text" pattern="[0-9]*" placeholder="请输入终端号">
        </div>
    </div>
</div>
<div class="weui_btn_area">
    <a id="queryBtn" href="javascript:;" class="weui_btn weui_btn_primary">查询</a>
</div> -->
    <div class="weui_search_bar" id="search_bar">
        <form class="weui_search_outer">
            <div class="weui_search_inner">
                <i class="weui_icon_search"></i>
                <input type="number" pattern="[0-9]*" class="weui_search_input" id="qTerminalNo" placeholder="搜索终端">
                <a href="javascript:" class="weui_icon_clear" id="search_clear"></a>
            </div>
            <label for="qTerminalNo" class="weui_search_text" id="search_text">
                <i class="weui_icon_search"></i>
                <span>搜索终端</span>
            </label>
        </form>
        <a href="javascript:" class="weui_search" id="search">搜索</a>
    </div>
    <div class="weui_grids terminal_dtl">
        <div class="weui_grid">
            <p class="weui_grid_label">
                终端10台
            </p>
        </div>
        <div class="weui_grid">
            <p class="weui_grid_label">
                启用2台
            </p>
        </div>
        <div class="weui_grid">
            <p class="weui_grid_label">
                停用8台
            </p>
        </div>
    </div>
    <div class="weui_cells_title thead">
        <div class="weui_grids">
            <div class="weui_grid">
                <p class="weui_grid_label">
                    终端号
                </p>
            </div>
            <div class="weui_grid">
                <p class="weui_grid_label">
                    状态
                </p>
            </div>
            <div class="weui_grid">
                <p class="weui_grid_label">
                    激活时间
                </p>
            </div>
            <div class="weui_grid">
                <p class="weui_grid_label">
                    商户简称
                </p>
            </div>
        </div>
    </div>
    <div id="wrapper">
        <div id="scroller">
            <div id="dataWrapper" class="data_wrap">
                <div class="weui_grids" data-terminal-status="停用">
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            终端号
                        </p>
                    </div>
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            状态
                        </p>
                    </div>
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            激活时间
                        </p>
                    </div>
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            商户简称
                        </p>
                    </div>
                </div>
                
                <div class="weui_grids" data-terminal-status="启用">
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            终端号
                        </p>
                    </div>
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            状态
                        </p>
                    </div>
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            激活时间
                        </p>
                    </div>
                    <div class="weui_grid">
                        <p class="weui_grid_label">
                            商户简称
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="actionSheet_wrap">
        <div class="weui_mask_transition weui_fade_toggle" id="mask"></div>
        <div class="weui_actionsheet weui_actionsheet_rtl" id="weui_actionsheet">
            <div class="weui_cells_title fs16">修改商户简称</div>
            <div id="merchantInfoWrap" class="weui_cells">
                <div class="weui_cell">
                    <div class="weui_cell_hd">
                        <label class="weui_label">终端号：</label>
                    </div>
                    <div id="terminalNo" class="weui_cell_bd weui_cell_primary">
                        12324343
                    </div>
                </div>
                <div class="weui_cell">
                    <div class="weui_cell_hd">
                        <label class="weui_label">旧商户简称：</label>
                    </div>
                    <div id="oldMrchntName" class="weui_cell_bd weui_cell_primary">
                        我么人呢
                    </div>
                </div>
                <div id="merchantNameOuter" class="weui_cell">
                    <div class="weui_cell_hd">
                        <label class="weui_label">新商户简称：</label>
                    </div>
                    <div class="weui_cell_bd weui_cell_primary">
                        <input id="newMrchntName" class="weui_input" placeholder="20个字符以内">
                    </div>
                </div>
            </div>
            <div class="weui_actionsheet_action">
                <div class="button_sp_area">
                    <a id="actionsheet_cancel" href="javascript:;" class="cancel_btn weui_btn weui_btn_mini weui_btn_primary">取消</a>
                    <a id="actionsheet_ok" href="javascript:;" class="weui_btn weui_btn_mini weui_btn_primary">确定</a>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    function query(terminalNo) {
        $.ajax({
            url: "js/test.json",
            type: "POST",
            data: {
                terminalNo: terminalNo
            },
            dataType: "json",
            beforeSend: function() {
                util.loadingToast();
            },
            success: function(data) {
                util.removeToast();
                if (data && data.code == 200) {
                    var html = "",
                        tpl = $("#tpl_trmnl_info").html();
                    data.data && data.data.forEach(function(item) {
                        html += tpl.format(item);
                    });
                    $("#dataWrapper").html(html);
                } else {
                    util.dialog({
                        info: data.msg
                    });
                }
            },
            error: function() {
                util.dialog({
                    info: "服务器异常，请稍候重试！"
                });
            }
        });
    }

    !util.browser.android && $('#weui_actionsheet').height($(window).height());

    $("#queryBtn").on(EV, function() {
        query($("#selectTerminal").val());
    });

    $("#selectTerminal").on("change", function() {
        query(this.value);
    });

    $("#dataWrapper").on(EV, ".weui_grids", function() {
        $("#terminalNo").text($(this).data("terminalno"));
        $("#oldMrchntName").text($(this).data("mrchntname"));
        util.showActionSheet();
    });

    $('#actionsheet_ok').on(EV, function() {
        alert("修改");
    });

    $(document).ready(function() {
        var $weuiSearchBar = $('#search_bar'),
            nHght = $weuiSearchBar.outerHeight(),
            offsetY = parseInt($("#wrapper").css("top"), 10);
        $weuiSearchBar.on('focus', '#qTerminalNo', function() {
            $weuiSearchBar.addClass('weui_search_focusing');
        }).on('blur', '#qTerminalNo', function() {
            $weuiSearchBar.removeClass('weui_search_focusing');
            if ($(this).val()) {
                $('#search_text').hide();
            } else {
                $('#search_text').show();
            }
        }).on('input', '#qTerminalNo', function() {

        }).on('touchend', '#search', function() {
            query(1);
        }).on('touchend', '#search_clear', function() {
            $('#qTerminalNo').val('');
        });

        $("body").on("touchstart", function(e) {
            //e.preventDefault();
            startX = e.originalEvent.changedTouches[0].pageX;
            startY = e.originalEvent.changedTouches[0].pageY;
        });
        $("body").on("touchmove", function(e) {
            e.preventDefault();
            moveEndX = e.originalEvent.changedTouches[0].pageX;
            moveEndY = e.originalEvent.changedTouches[0].pageY;
            X = moveEndX - startX;
            Y = moveEndY - startY;

            if (Math.abs(Y) > Math.abs(X) && Y > 0) {
                $weuiSearchBar.removeClass("searchBar_fadeOut");
                $("#wrapper").css("top", offsetY + "px");
            } else if (Math.abs(Y) > Math.abs(X) && Y < 0) {
                $weuiSearchBar.addClass("searchBar_fadeOut");
                $("#wrapper").css("top", offsetY - nHght + "px");
            }
        });

        $("#newMrchntName").on("click", function() {
            //this.scrollIntoViewIfNeeded();
            setTimeout(function() {
                //$('#weui_actionsheet').height($(window).height());
            }, 500);
        });

        console.log($("#dataWrapper .weui_grids").slice(-2));

        jQuery.each($("#dataWrapper .weui_grids").slice(-2), function() {
            $(this).data("terminalStatus") == "启用" && $(this).addClass("active");
        });
    });
    </script>
</body>

</html>
