var util=function(){};var hasTouch="ontouchstart"in window,EV="click",PAGE_SIZE=20;util.query=function(e,t){var a=e.url,i=e.dataWrapId||"dataWrapper",l=e.tplId,n=e.pullUpId||"pullUp",o=e.iScroll,s=e.indexRequired;delete e.id,delete e.dataWrapId,delete e.tplId,delete e.pullUpId,delete e.pullDownId;delete e.url,delete e.pullUpAction,delete e.pullDownAction,delete e.iScroll,delete e.indexRequired;$.ajax({url:a,type:"POST",data:e,dataType:"json",beforeSend:function(){e.pageIndex==1&&util.loadingToast()},success:function(a){util.removeToast();if(a&&(a.code==200||a.rtnCode==200)){var r="",d=$("#"+l).html();a.data&&a.data.forEach(function(t,a){s&&(t["index"]=(e.pageIndex-1)*e.pageSize+a+1);r+=d.format(t)});e.pageIndex==1?$("#"+i).html(r):$("#"+i).append(r);$("#"+i).data("pageIndex",e.pageIndex);!+a.totalPage||a.totalPage==1||e.pageIndex==a.totalPage?$("#"+n).addClass("dn"):$("#"+n).removeClass("dn");o&&o.refresh();t&&t(a.data)}else{util.dialog({info:a.msg||a.rtnMsg})}},error:function(){util.dialog({info:"服务器异常，请稍候重试！"})}})};util.wxUploadImage=function(e,t,a,i){t=$.extend({count:1,sizeType:["original","compressed"],sourceType:["album","camera"]},t||{});e.chooseImage({count:t.count,sizeType:t.sizeType,sourceType:t.sourceType,success:function(t){var l={localId:[],serverId:[]};l.localId=t.localIds;if(l.localId.length==0){alert("请先使用 chooseImage 接口选择图片");return}var n=0,o=l.localId.length;function s(){e.uploadImage({localId:l.localId[n],isShowProgressTips:1,success:function(e){n++;l.serverId.push(e.serverId);a&&a(localId,e.serverId);if(n<o){s()}},fail:function(e){alert(JSON.stringify(e));i&&i(e)}})}s()}})};util.compose=function(e,t,a,i){var l=document.createElement("canvas"),n=l.getContext("2d"),o=e.length,s;l.width=t;l.height=a;n.rect(0,0,l.width,l.height);n.fillStyle="#fff";n.fill();function r(t){if(t<o){var a=new Image;a.src=data[t].url;a.onload=function(){n.drawImage(a,e[t].offsetX,e[t].offsetY,a.width,a.height);a=null;r(t+1)}}else{s=l.toDataURL("image/jpeg",.8);l=null;i(s)}}r(0)};util.initIScroll=function(e){var t,e=e||{},a,i,l,n,o=0;var s=e.pullDownAction||function(){t.refresh()},r=e.pullUpAction||function(){t.refresh()};document.addEventListener("touchmove",function(e){e.preventDefault()},false);a=$("#"+(e["pullDownId"]||"pullDown"));a=a.length&&a[0];i=a&&a.offsetHeight;l=$("#"+(e["pullUpId"]||"pullUp"))[0];n=l.offsetHeight;var d=e["id"]||"wrapper",u=e["dataWrapId"]||"dataWrapper",c=$("#"+d),f=c.parents(".tab_wrap"),g=f.hasClass("dn");g&&f.removeClass("dn");var p=c.position().top;c.css({position:"absolute",left:0,top:p+"px",bottom:0,width:"100%"});g&&f.addClass("dn");t=new iScroll(d,{vScrollbar:false,topOffset:i||0,onRefresh:function(){if(a&&a.className.match("loading")){$(a).removeClass("loading");a.querySelector(".pullDownLabel").innerHTML="下拉刷新..."}else if(l.className.match("loading")){$(l).removeClass("loading");l.querySelector(".pullUpLabel").innerHTML="上拉加载更多..."}},onScrollMove:function(){if(this.y>5&&a&&!a.className.match("flip")){$(a).addClass("flip");a.querySelector(".pullDownLabel").innerHTML="松手开始更新...";this.minScrollY=0}else if(this.y<this.maxScrollY-5&&!l.className.match("flip")){if($(l).hasClass("dn"))return;$(l).addClass("flip");l.querySelector(".pullUpLabel").innerHTML="松手开始更新..."}},onScrollEnd:function(){if(a&&a.className.match("flip")){$(a).removeClass("flip").addClass("loading");a.querySelector(".pullDownLabel").innerHTML="加载中...";s(1)}else if(l.className.match("flip")){$(l).removeClass("flip").addClass("loading");l.querySelector(".pullUpLabel").innerHTML="加载中...";var e=$("#"+u).data("pageIndex")||1;r(++e)}}});return t};util.showActionSheet=function(e){var t=$("#mask");var a=$("#weui_actionsheet");a.addClass("weui_actionsheet_toggle");t.show().focus().addClass("weui_fade_toggle").one("click",function(){util.hideActionSheet()});$("#actionsheet_cancel").one("click",function(){e&&e();util.hideActionSheet()});t.unbind("transitionend").unbind("webkitTransitionEnd")};util.hideActionSheet=function(){var e=$("#mask");var t=$("#weui_actionsheet");t.removeClass("weui_actionsheet_toggle");e.removeClass("weui_fade_toggle");e.on("transitionend",function(){e.hide()}).on("webkitTransitionEnd",function(){e.hide()})};util.dialog=function(e){var t='<div class="weui_dialog_confirm" id="dialog">'+'<div class="weui_mask"></div>'+'<div class="weui_dialog">'+'<div class="weui_dialog_hd"><strong class="weui_dialog_title">'+(e.title||"提示")+"</strong></div>"+'<div class="weui_dialog_bd">'+e.info+"</div>"+'<div class="weui_dialog_ft">'+(e.cancel?'<a href="javascript:;" class="weui_btn_dialog default">取消</a>':"")+'<a href="javascript:;" class="weui_btn_dialog primary">确定</a>'+"</div>"+"</div>"+"</div>";var a=$(t);a.on(EV,".weui_btn_dialog.default",function(){e.cancelCb&&e.cancelCb();$("#dialog").remove()}).on(EV,".weui_btn_dialog.primary",function(){e.okCb&&e.okCb();$("#dialog").remove()});$("body").append(a)};util.toast=function(e){var t='<div id="toast">'+'<div class="weui_mask_transparent"></div>'+'<div class="weui_toast">'+'<i class="weui_icon_toast"></i>'+'<p class="weui_toast_content">'+e+"</p>"+"</div>"+"</div>";$("body").append(t);setTimeout(function(){$("#toast").remove()},2e3)};util.loadingToast=function(){var e='<div id="loadingToast" class="weui_loading_toast">'+'<div class="weui_mask_transparent"></div>'+'<div class="weui_toast">'+'<div class="weui_loading">'+'<div class="weui_loading_leaf weui_loading_leaf_0"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_1"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_2"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_3"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_4"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_5"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_6"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_7"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_8"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_9"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_10"></div>'+'<div class="weui_loading_leaf weui_loading_leaf_11"></div>'+"</div>"+'<p class="weui_toast_content">数据加载中</p>'+"</div>"+"</div>";$("body").append(e)};util.removeToast=function(){$("#toast, #loadingToast").remove()};util.strLen=function(e){return(e||"").replace(/[^\x00-\xff]/g,"00").length};util.formatBankCard=function(e,t){e=e.replace(/\s/g,"");if(t){return e.substring(0,6)+"*****"+e.substring(e.length-4)}return e.replace(/(\d{4})(?!$)/g,"$1 ")};util.isValidId=function(e){return/(^\d{15}$)|(^\d{17}([0-9]|X|x)$)/.test(e)};util.isValidMobile=function(e){return/^1[34578]\d{9}$/.test(e)};util.queryToJson=function(e){var t=e.substr(e.lastIndexOf("?")+1),a=t.split("&"),i=a.length,l={},n=0,o,s,r,d;for(;n<i;n++){if(!a[n]){continue}d=a[n].split("=");o=d[0];s=d[1];r=l[o];if("undefined"==typeof r){l[o]=s}else if(isArray(r)){r.push(s)}else{l[o]=[r,s]}}return l};Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var a,i;if(this==null){throw new TypeError(" this is null or not defined")}var l=Object(this);var n=l.length>>>0;if({}.toString.call(e)!="[object Function]"){throw new TypeError(e+" is not a function")}if(t){a=t}i=0;while(i<n){var o;if(i in l){o=l[i];e.call(a,o,i,l)}i++}});Date.prototype.format=function(e){e=e||"yyyy-MM-dd";var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var a in t)if(new RegExp("("+a+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[a]:("00"+t[a]).substr((""+t[a]).length));return e};String.prototype.format=function(e){var t,a=this;if(arguments.length>0){if(arguments.length==1&&typeof e=="object"){for(var i in e){t=new RegExp("({{"+i+"}})","g");a=a.replace(t,e[i]||"")}}else{for(var l=0;l<arguments.length;l++){t=new RegExp("({{)"+l+"(}})","g");a=a.replace(t,arguments[l]||"")}}}return a};Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++){if(this[t]==e)return t}return-1};Array.prototype.remove=function(e){var t=this.indexOf(e);if(t>-1){this.splice(t,1)}};function getDaysInMonth(e,t){return new Date(e||(new Date).getFullYear(),t,0).getDate()}function getTargetDate(e,t,a){var i=a||new Date;var l=i.getFullYear();var n=i.getMonth();var o=new Date;var s=Math.floor(e/30);if(s<=0){var r=i.valueOf()-e*24*60*60*1e3;o=new Date(r)}else{var d=n-s;while(d<0){d+=12;l--}o.setFullYear(l);var u=getDaysInMonth(l,d+1);u>i.getDate()&&(u=i.getDate());o.setMonth(d,u);o.setHours(i.getHours());o.setMinutes(i.getMinutes());o.setSeconds(i.getSeconds());o.setMilliseconds(i.getMilliseconds())}return t?o<t?t:o:o}$(document).ready(function(){});util.initPage=function(e){$(document).ready(function(){var e=$(window).height(),t=$("#weui_actionsheet").height();$("#weui_actionsheet").height(e);if(e<=t){$("#weui_actionsheet").css({"overflow-y":"auto"})}else{$("#btnWrap").addClass("btnWrapAbs")}var a=new Date;a.setDate(1);var i={theme:"mobiscroll",lang:"zh",display:"top",mode:"scroller",dateFormat:"mm-dd",defaultValue:[new Date,new Date],minDate:getTargetDate(180),maxDate:new Date,onSelect:function(e,t){$("#rangeDate, #filterDate").text(e.replace(/\s-\s/," 至 "));$("#rangeDate, #filterRangeDate").mobiscroll("setValue",t.getVal())}};$("#rangeDate, #filterRangeDate").mobiscroll().range(i);$("#filterRangeDate").mobiscroll("setValue",[getTargetDate(180),new Date]);$("#rangeDate, #filterDate").text((new Date).format("MM-dd"));$("#rangeDate, #filterRangeDate").on(EV,function(){return $(this).mobiscroll("show"),false});$("#consumptionTypeWrap").on(EV,"a.weui_grid",function(){$(".weui_grid_label",this).toggleClass("active");var e=$(".weui_grid_label",this).hasClass("active");if($(this).hasClass("check_all")){var t=e?"addClass":"removeClass";$(this).siblings().each(function(){$(".weui_grid_label",this)[t]("active")})}else{if(!e){$(".check_all .weui_grid_label").removeClass("active")}else{var a=!0;$(this).siblings().each(function(){if($(this).hasClass("check_all"))return;return!$(".weui_grid_label",this).hasClass("active")&&(a=!1),a});a&&$(".check_all .weui_grid_label").addClass("active")}}});$("#settleTypeWrap, #storeWrap").on(EV,"a.weui_grid",function(){$(".weui_grid_label",this).toggleClass("active")});$("#weui_actionsheet").on("click",".filter_back",function(){util.hideActionSheet()})})};util.initPrintMerName=function(e){$.ajax({url:e,type:"POST",dataType:"json",beforeSend:function(){util.loadingToast()},success:function(e){util.removeToast();if(e&&e.code==200){var t="";e.data&&e.data.forEach(function(e){t+=" <a href='javascript:;' class='weui_grid'><p class='weui_grid_label'>"+e.terminalAlias+"</p></a>"});$("#storeWrap").html(t)}else{}},error:function(){}})};~function(){var e={},t=navigator.userAgent.toLowerCase();e.iPhone=/iphone os/.test(t);e.iPod=/ipod/i.test(t);e.iPad=/ipad/.test(t);e.android=/android/.test(t);util.browser=e}();